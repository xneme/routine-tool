---
phase: 01-foundation-quick-capture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - build.gradle.kts
  - app/build.gradle.kts
  - gradle/libs.versions.toml
  - settings.gradle.kts
  - app/src/main/java/com/routinetool/data/local/entities/TaskEntity.kt
  - app/src/main/java/com/routinetool/data/local/database/TaskDao.kt
  - app/src/main/java/com/routinetool/data/local/database/AppDatabase.kt
  - app/src/main/java/com/routinetool/data/repository/TaskRepository.kt
  - app/src/main/java/com/routinetool/di/AppModule.kt
  - app/src/main/java/com/routinetool/ui/theme/Theme.kt
  - app/src/main/java/com/routinetool/ui/theme/Color.kt
  - app/src/main/java/com/routinetool/ui/theme/Type.kt
  - app/src/main/java/com/routinetool/RoutineToolApp.kt
  - app/src/main/java/com/routinetool/MainActivity.kt
  - app/src/main/AndroidManifest.xml
autonomous: true

must_haves:
  truths:
    - "Android project compiles and launches on emulator/device"
    - "Room database is created on first launch with tasks table"
    - "Repository can insert and query tasks via Flow"
    - "Material 3 theme applies with monochrome + accent color palette"
  artifacts:
    - path: "gradle/libs.versions.toml"
      provides: "Version catalog with all dependencies"
      contains: "composeBom"
    - path: "app/src/main/java/com/routinetool/data/local/entities/TaskEntity.kt"
      provides: "Task data model for Room"
      contains: "data class TaskEntity"
    - path: "app/src/main/java/com/routinetool/data/local/database/TaskDao.kt"
      provides: "Data access object for tasks"
      contains: "interface TaskDao"
    - path: "app/src/main/java/com/routinetool/data/local/database/AppDatabase.kt"
      provides: "Room database definition"
      contains: "abstract class AppDatabase"
    - path: "app/src/main/java/com/routinetool/data/repository/TaskRepository.kt"
      provides: "Repository abstracting data access"
      contains: "class TaskRepository"
    - path: "app/src/main/java/com/routinetool/di/AppModule.kt"
      provides: "Koin dependency injection modules"
      contains: "appModule"
  key_links:
    - from: "AppDatabase"
      to: "TaskDao"
      via: "abstract fun taskDao()"
      pattern: "abstract fun taskDao"
    - from: "TaskRepository"
      to: "TaskDao"
      via: "constructor injection"
      pattern: "class TaskRepository.*TaskDao"
    - from: "AppModule"
      to: "AppDatabase"
      via: "Koin single definition"
      pattern: "single.*AppDatabase"
---

<objective>
Set up the Android project from scratch with all dependencies, Room database, repository pattern, Koin DI, and Material 3 theme.

Purpose: This is the foundation that all subsequent plans build on. Without a compilable project with a working data layer and theme, no UI work can proceed.
Output: A compilable Android app that launches to an empty screen with correct theme, backed by a Room database ready to store tasks.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-quick-capture/01-RESEARCH.md
@.planning/phases/01-foundation-quick-capture/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Android project with Gradle version catalog</name>
  <files>
    build.gradle.kts
    app/build.gradle.kts
    gradle/libs.versions.toml
    settings.gradle.kts
    app/src/main/AndroidManifest.xml
  </files>
  <action>
    Create a new Android project structure for "Routine Tool" with package `com.routinetool`.

    **gradle/libs.versions.toml** — Version catalog with:
    - kotlin = "2.3.0"
    - composeBom = "2024.12.01"
    - room = "2.7.0"
    - navigationCompose = "2.8.5"
    - koin = "4.0.0"
    - kotlinxDatetime = "0.7.1"
    - kotlinxCoroutines = "1.9.0"
    - lifecycleRuntime = "2.8.7"
    - activityCompose = "1.9.3"
    - coreKtx = "1.15.0"
    - ksp = "2.3.0-1.0.30"

    Libraries section should include compose-bom, compose-material3, compose-ui, compose-ui-tooling-preview, room-runtime, room-ktx, room-compiler (ksp), navigation-compose, koin-android, koin-compose, kotlinx-datetime, lifecycle-runtime-compose, lifecycle-viewmodel-compose, activity-compose, core-ktx.

    Plugins: android-application, kotlin-android, compose-compiler, ksp.

    **build.gradle.kts (root)** — Apply plugins with `apply false`. Include compose compiler plugin.

    **app/build.gradle.kts** — Apply plugins (android, kotlin, compose, ksp). Configure:
    - compileSdk = 35, minSdk = 26, targetSdk = 35
    - namespace = "com.routinetool"
    - Enable compose with buildFeatures
    - Room schema export: `ksp { arg("room.schemaLocation", "$projectDir/schemas") }`
    - All library dependencies from version catalog
    - Java 17 compatibility

    **settings.gradle.kts** — Project name "RoutineTool", include ":app", configure repositories.

    **app/src/main/AndroidManifest.xml** — Declare application (RoutineToolApp) and MainActivity with launcher intent.
  </action>
  <verify>
    Run `./gradlew assembleDebug` from project root — must compile without errors.
  </verify>
  <done>
    Project structure exists with all dependencies declared. Gradle sync succeeds. Debug build compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Room database with TaskEntity, DAO, and repository</name>
  <files>
    app/src/main/java/com/routinetool/data/local/entities/TaskEntity.kt
    app/src/main/java/com/routinetool/data/local/database/TaskDao.kt
    app/src/main/java/com/routinetool/data/local/database/AppDatabase.kt
    app/src/main/java/com/routinetool/data/repository/TaskRepository.kt
  </files>
  <action>
    **TaskEntity.kt:**
    ```kotlin
    @Entity(tableName = "tasks")
    data class TaskEntity(
        @PrimaryKey val id: String = UUID.randomUUID().toString(),
        val title: String,
        val description: String? = null,
        val softDeadline: Long? = null,    // epoch millis for Room compatibility
        val hardDeadline: Long? = null,    // epoch millis
        val isCompleted: Boolean = false,
        val completedAt: Long? = null,     // epoch millis
        val archivedAt: Long? = null,      // epoch millis — set 24h after completion for Done section hiding
        val createdAt: Long = Clock.System.now().toEpochMilliseconds(),
        val taskType: String = "ONE_TIME"  // future-proofing for Phase 4
    )
    ```

    Use Long (epoch millis) for timestamps — Room doesn't natively support kotlinx-datetime Instant. Conversion happens in the repository/domain layer.

    **TaskDao.kt:**
    ```kotlin
    @Dao
    interface TaskDao {
        // Active tasks ordered by deadline proximity (overdue first, then by nearest deadline, no-deadline last)
        @Query("""
            SELECT * FROM tasks
            WHERE isCompleted = 0
            ORDER BY
                CASE
                    WHEN COALESCE(hardDeadline, softDeadline) IS NOT NULL
                         AND COALESCE(hardDeadline, softDeadline) < :now THEN 0
                    WHEN COALESCE(hardDeadline, softDeadline) IS NOT NULL THEN 1
                    ELSE 2
                END,
                COALESCE(hardDeadline, softDeadline) ASC
        """)
        fun observeActiveTasks(now: Long): Flow<List<TaskEntity>>

        // Recently completed tasks (within last 24 hours)
        @Query("SELECT * FROM tasks WHERE isCompleted = 1 AND completedAt > :since ORDER BY completedAt DESC")
        fun observeRecentlyCompleted(since: Long): Flow<List<TaskEntity>>

        @Query("SELECT * FROM tasks WHERE id = :id")
        suspend fun getById(id: String): TaskEntity?

        @Insert(onConflict = OnConflictStrategy.REPLACE)
        suspend fun insert(task: TaskEntity)

        @Update
        suspend fun update(task: TaskEntity)

        @Query("UPDATE tasks SET isCompleted = 1, completedAt = :completedAt WHERE id = :id")
        suspend fun completeTask(id: String, completedAt: Long)

        @Query("UPDATE tasks SET isCompleted = 0, completedAt = NULL WHERE id = :id")
        suspend fun uncompleteTask(id: String)
    }
    ```

    **AppDatabase.kt:**
    ```kotlin
    @Database(
        entities = [TaskEntity::class],
        version = 1,
        exportSchema = true
    )
    abstract class AppDatabase : RoomDatabase() {
        abstract fun taskDao(): TaskDao
    }
    ```

    **TaskRepository.kt:**
    Repository wraps DAO with domain-friendly API. Converts epoch millis to/from kotlinx-datetime Instant where needed. Exposes `Flow<List<TaskEntity>>` for active tasks and recently completed tasks. Provides suspend functions for insert, update, complete, uncomplete.
  </action>
  <verify>
    Build succeeds with `./gradlew assembleDebug`. Room schema JSON exported to `app/schemas/` directory.
  </verify>
  <done>
    TaskEntity defined with all Phase 1 fields. DAO provides ordered active tasks, recently completed tasks, and CRUD operations. Repository wraps DAO. Schema exports enabled for future migrations.
  </done>
</task>

<task type="auto">
  <name>Task 3: Koin DI, Material 3 theme, and app scaffolding</name>
  <files>
    app/src/main/java/com/routinetool/di/AppModule.kt
    app/src/main/java/com/routinetool/ui/theme/Theme.kt
    app/src/main/java/com/routinetool/ui/theme/Color.kt
    app/src/main/java/com/routinetool/ui/theme/Type.kt
    app/src/main/java/com/routinetool/RoutineToolApp.kt
    app/src/main/java/com/routinetool/MainActivity.kt
  </files>
  <action>
    **AppModule.kt:**
    Koin module providing:
    - `single { Room.databaseBuilder(get(), AppDatabase::class.java, "routine_tool_db").build() }`
    - `single { get<AppDatabase>().taskDao() }`
    - `single { TaskRepository(get()) }`
    - ViewModels will be added in subsequent plans

    **Color.kt:**
    Define a monochrome palette with a single accent color. The app should feel clean, neutral, and tool-like:
    - Surface/background: near-white (#FAFAFA) light, near-black (#121212) dark
    - On-surface: standard contrast text
    - Primary/accent: a calm, muted blue-grey (not bright, not playful) — e.g., #5C6BC0 (indigo-ish)
    - SurfaceVariant: for overdue badges and subtle indicators
    - No red/error colors for overdue states — use surfaceVariant instead
    - Support both light and dark color schemes

    **Type.kt:**
    Material 3 typography with system default font. No custom fonts. Clean and readable.

    **Theme.kt:**
    Material 3 theme using `lightColorScheme()` and `darkColorScheme()` with the defined colors. Use `isSystemInDarkTheme()` for automatic switching. Wrap content in `MaterialTheme`.

    **RoutineToolApp.kt:**
    Application class extending `Application()` and implementing Koin:
    ```kotlin
    class RoutineToolApp : Application() {
        override fun onCreate() {
            super.onCreate()
            startKoin {
                androidContext(this@RoutineToolApp)
                modules(appModule)
            }
        }
    }
    ```

    **MainActivity.kt:**
    Single activity with `setContent` applying the RoutineToolTheme. For now, display a simple `Scaffold` with empty content — subsequent plans will add screens and navigation.
  </action>
  <verify>
    Run `./gradlew assembleDebug` — compiles. Launch on emulator — app opens with correct theme colors, empty screen, no crashes.
  </verify>
  <done>
    Koin provides database, DAO, and repository. Material 3 theme applies with monochrome + accent palette. App launches to themed empty scaffold. Foundation is complete for UI development.
  </done>
</task>

</tasks>

<verification>
1. `./gradlew assembleDebug` completes without errors
2. App installs and launches on Android emulator (API 26+)
3. App displays themed empty scaffold (correct background color)
4. Room database created on launch (check with Android Studio Database Inspector or `adb shell run-as com.routinetool ls databases/`)
5. No crashes on launch or rotation
</verification>

<success_criteria>
- Android project compiles with all required dependencies
- Room database schema exports to `app/schemas/` directory
- TaskEntity has all Phase 1 fields (title, description, soft/hard deadline, completion state, timestamps)
- DAO provides deadline-proximity ordering and recently-completed queries
- Koin DI wires database → DAO → repository
- Material 3 theme renders with calm, monochrome aesthetic
- App launches without crashes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-quick-capture/01-01-SUMMARY.md`
</output>
